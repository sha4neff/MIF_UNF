
#Область ОбработчикиСобытий

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Элементы.Список.РежимВыбора=ЭтаФорма.Параметры.РежимВыбора;

	Если Элементы.Список.РежимВыбора Тогда
		РежимОткрытияОкна=РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
	КонецЕсли;
	
	Если Параметры.Свойство("ТолькоТипДата") И Параметры.ТолькоТипДата Тогда
		ТипРеквизитаОтбор=Справочники.КП_СписокМетаданных.Дата;
	Иначе
		ТипРеквизитаОтбор=Неопределено;
	КонецЕсли;
	
	Параметры.Свойство("Владелец", ОтборВладелец);
	
	Если Параметры.Свойство("Заголовок") Тогда
		ЭтаФорма.АвтоЗаголовок=Ложь;
		ЭтаФорма.Заголовок=Параметры.Заголовок;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ОтборВладелец) И Параметры.Свойство("Отбор") Тогда
		Параметры.Отбор.Свойство("Владелец", ОтборВладелец);
	КонецЕсли;

	ОбновитьСписок();
	
КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	Отказ=Истина;
	
	//откроем форму нового реквизита
	ПараметрыФормы=Новый Структура("РежимВыбора, МножественныйВыбор", Истина, Ложь);
	
	ПараметрыЗаполнения=Новый Структура("Владелец", ОтборВладелец);
	ПараметрыФормы.Вставить("ЗначенияЗаполнения", ПараметрыЗаполнения);

	//ОткрытьФорму("Справочник.КП_ДополнительныеРеквизиты.ФормаОбъекта", ПараметрыФормы,,,,, Новый ОписаниеОповещения("Подключаемый_ДобавлениеЗавершено", ЭтотОбъект), РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс);
	
	ОткрытьФорму("Справочник.КП_ДополнительныеРеквизиты.ФормаОбъекта", ПараметрыФормы,,,,, Неопределено, РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ОтборВладелецПриИзменении(Элемент)
	ОбновитьСписок();
КонецПроцедуры

&НаСервере
Процедура ОбновитьСписок()
	
	Список.Параметры.УстановитьЗначениеПараметра("Владелец", ?(ЗначениеЗаполнено(ОтборВладелец), ОтборВладелец, NULL));
	Список.Параметры.УстановитьЗначениеПараметра("ТипРеквизита", ?(ЗначениеЗаполнено(ТипРеквизитаОтбор), ТипРеквизитаОтбор, NULL));

КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ДобавлениеЗавершено(Результат, ДополнительныеПараметры) Экспорт
    
	//Элементы.Список.Обновить();
	
КонецПроцедуры

#КонецОбласти