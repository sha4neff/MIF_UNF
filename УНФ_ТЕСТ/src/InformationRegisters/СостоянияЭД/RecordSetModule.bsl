#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда 
		Возврат; 
	КонецЕсли;
 
	Для Каждого Запись Из ЭтотОбъект Цикл
		ПредставлениеПрогрессаПодписания = Неопределено;
		ПредставлениеСтатуса = Строка(Запись.СостояниеВерсииЭД);
		Если Запись.СостояниеВерсииЭД = Перечисления.СостоянияВерсийЭД.НаПодписи 
			И ЗначениеЗаполнено(Запись.ЭлектронныйДокумент) Тогда
			ФайлЭД = ОбменСКонтрагентамиСлужебный.ПрисоединенныйФайл(Запись.ЭлектронныйДокумент);
			
			Если ЗначениеЗаполнено(ФайлЭД) Тогда
				ПредставлениеПрогрессаПодписания = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ФайлЭД, 
				"ПредставлениеПрогрессаПодписания");
			КонецЕсли;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ПредставлениеПрогрессаПодписания) Тогда
			Запись.ПредставлениеСостояния = СтрШаблон("%1 %2", ПредставлениеСтатуса, ПредставлениеПрогрессаПодписания);
		Иначе
			Запись.ПредставлениеСостояния = ПредставлениеСтатуса;
		КонецЕсли;
		
		ПараметрыЭД = ОбменСКонтрагентамиСлужебный.ЗаполнитьПараметрыЭДПоИсточнику(Запись.СсылкаНаОбъект);
		
		Если ПараметрыЭД.ВидЭД = Перечисления.ВидыЭД.Внутренний Тогда 
			Запись.ЭлектронныйДокумент = Неопределено;
			Запись.ПредставлениеСостояния = ОбменСКонтрагентамиСлужебный.ИтоговоеСостояниеЭД(Запись.СсылкаНаОбъект);
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти

#Иначе
	
	ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
	
#КонецЕсли
