
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	Если Параметры.Свойство("Ссылка") Тогда
		ОбъектОбсуждения = Параметры.Ссылка;
	Иначе
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Обсуждение = ОбсужденияУНФВызовСервера.ОбсужденияПоОбъекту(ОбъектОбсуждения);
	
	Если Константы.ИспользоватьЧатВОбсуждениях.Получить() = Истина И НЕ СистемаВзаимодействия.ИнформационнаяБазаЗарегистрирована() Тогда
		Элементы.ГруппаСообщение.Видимость = Истина;
	Иначе
		Элементы.ГруппаСообщение.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

#Область Обсуждения

&НаКлиенте
Процедура СообщениеАвтоПодбор(Элемент, Текст, ДанныеВыбора, Параметры, Ожидание, СтандартнаяОбработка)
	
	ОбсужденияУНФКлиент.СообщениеАвтоПодбор(ЭтаФорма, ОбъектОбсуждения, Текст, ДанныеВыбора, СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура СообщениеОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	ОбсужденияУНФКлиент.СообщениеОбработкаВыбора(ЭтаФорма, ОбъектОбсуждения, Элемент, ВыбранноеЗначение, СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьСообщение(Команда)
	
	ОбсужденияУНФКлиент.ДобавитьСообщение(СообщениеПользователя, ОбъектОбсуждения, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбсуждениеПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
	
	СообщениеПользователя = Элементы.Сообщение.ТекстРедактирования;
	ОбсужденияУНФКлиент.ОбработатьНажатие(ЭтаФорма, Элемент, ДанныеСобытия, СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбсуждениеДобавитьСимволСобака(Команда)
	
	Если Прав(Элементы.Сообщение.ТекстРедактирования, 1)=" " ИЛИ ПустаяСтрока(Элементы.Сообщение.ТекстРедактирования) Тогда
		Элементы.Сообщение.ВыделенныйТекст = "@";
	Иначе
		Элементы.Сообщение.ВыделенныйТекст = " @";
	КонецЕсли;
		
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьОбсуждения() Экспорт
	
	Обсуждение = ОбсужденияУНФВызовСервера.ОбсужденияПоОбъекту(ОбъектОбсуждения);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если НЕ Источник=ОбъектОбсуждения Тогда
		Возврат;
	КонецЕсли;
	
	Если ИмяСобытия="Обсуждение_ДобавлениеКомментария" Тогда
		ОбновитьОбсуждения();
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
